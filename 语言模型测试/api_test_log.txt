[2025-05-05T09:45:46.288Z] ====== API测试开始 ======
[2025-05-05T09:45:46.344Z] 测试时间: 2025/5/5 17:45:46
[2025-05-05T09:45:46.345Z] 
开始测试 DeepSeek (OpenRouter)...
[2025-05-05T09:45:46.346Z] API URL: https://openrouter.ai/api/v1/chat/completions
[2025-05-05T09:45:46.348Z] 模型ID: deepseek/deepseek-chat-v3-0324:free
[2025-05-05T09:45:46.349Z] 开始请求时间: 2025-05-05T09:45:46.349Z
[2025-05-05T09:45:46.351Z] 请求体: {
  "model": "deepseek/deepseek-chat-v3-0324:free",
  "messages": [
    {
      "role": "system",
      "content": "你是一个有帮助的AI助手，专注于中文对话。请提供简短的回答。"
    },
    {
      "role": "user",
      "content": "你好，请用中文回答：今天天气怎么样？请简短回复一句话"
    }
  ]
}
[2025-05-05T09:45:47.357Z] ❌ DeepSeek (OpenRouter) 测试失败
[2025-05-05T09:45:47.359Z] 状态码: 401
[2025-05-05T09:45:47.361Z] 错误数据: {
  "error": {
    "message": "No auth credentials found",
    "code": 401
  }
}
[2025-05-05T09:45:47.364Z] 详细错误: {
  "message": "Request failed with status code 401",
  "name": "AxiosError",
  "stack": "AxiosError: Request failed with status code 401\n    at settle (D:\\LdWork\\project\\语言模型测试\\node_modules\\axios\\dist\\node\\axios.cjs:2049:12)\n    at IncomingMessage.handleStreamEnd (D:\\LdWork\\project\\语言模型测试\\node_modules\\axios\\dist\\node\\axios.cjs:3166:11)\n    at IncomingMessage.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (D:\\LdWork\\project\\语言模型测试\\node_modules\\axios\\dist\\node\\axios.cjs:4276:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async testAPI (D:\\LdWork\\project\\语言模型测试\\api_test.js:67:26)\n    at async runTests (D:\\LdWork\\project\\语言模型测试\\api_test.js:177:30)",
  "config": {
    "transitional": {
      "silentJSONParsing": true,
      "forcedJSONParsing": true,
      "clarifyTimeoutError": false
    },
    "adapter": [
      "xhr",
      "http",
      "fetch"
    ],
    "transformRequest": [
      null
    ],
    "transformResponse": [
      null
    ],
    "timeout": 30000,
    "xsrfCookieName": "XSRF-TOKEN",
    "xsrfHeaderName": "X-XSRF-TOKEN",
    "maxContentLength": -1,
    "maxBodyLength": -1,
    "env": {},
    "headers": {
      "Accept": "application/json, text/plain, */*",
      "Content-Type": "application/json",
      "Authorization": "Bearer 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",
      "User-Agent": "axios/1.9.0",
      "Content-Length": "284",
      "Accept-Encoding": "gzip, compress, deflate, br"
    },
    "method": "post",
    "url": "https://openrouter.ai/api/v1/chat/completions",
    "data": "{\"model\":\"deepseek/deepseek-chat-v3-0324:free\",\"messages\":[{\"role\":\"system\",\"content\":\"你是一个有帮助的AI助手，专注于中文对话。请提供简短的回答。\"},{\"role\":\"user\",\"content\":\"你好，请用中文回答：今天天气怎么样？请简短回复一句话\"}]}",
    "allowAbsoluteUrls": true
  },
  "code": "ERR_BAD_REQUEST",
  "status": 401
}
[2025-05-05T09:45:47.373Z] 
开始测试 DeepSeek (Chutes)...
[2025-05-05T09:45:47.375Z] API URL: https://llm.chutes.ai/v1/chat/completions
[2025-05-05T09:45:47.376Z] 模型ID: deepseek-ai/DeepSeek-V3-0324
[2025-05-05T09:45:47.378Z] 开始请求时间: 2025-05-05T09:45:47.378Z
[2025-05-05T09:45:47.379Z] 请求体: {
  "model": "deepseek-ai/DeepSeek-V3-0324",
  "messages": [
    {
      "role": "system",
      "content": "你是一个有帮助的AI助手，专注于中文对话。请提供简短的回答。"
    },
    {
      "role": "user",
      "content": "你好，请用中文回答：今天天气怎么样？请简短回复一句话"
    }
  ]
}
[2025-05-05T09:45:48.119Z] ❌ DeepSeek (Chutes) 测试失败
[2025-05-05T09:45:48.120Z] 状态码: 429
[2025-05-05T09:45:48.121Z] 错误数据: "wait a moment"
[2025-05-05T09:45:48.123Z] 详细错误: {
  "message": "Request failed with status code 429",
  "name": "AxiosError",
  "stack": "AxiosError: Request failed with status code 429\n    at settle (D:\\LdWork\\project\\语言模型测试\\node_modules\\axios\\dist\\node\\axios.cjs:2049:12)\n    at IncomingMessage.handleStreamEnd (D:\\LdWork\\project\\语言模型测试\\node_modules\\axios\\dist\\node\\axios.cjs:3166:11)\n    at IncomingMessage.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (D:\\LdWork\\project\\语言模型测试\\node_modules\\axios\\dist\\node\\axios.cjs:4276:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async testAPI (D:\\LdWork\\project\\语言模型测试\\api_test.js:67:26)\n    at async runTests (D:\\LdWork\\project\\语言模型测试\\api_test.js:178:26)",
  "config": {
    "transitional": {
      "silentJSONParsing": true,
      "forcedJSONParsing": true,
      "clarifyTimeoutError": false
    },
    "adapter": [
      "xhr",
      "http",
      "fetch"
    ],
    "transformRequest": [
      null
    ],
    "transformResponse": [
      null
    ],
    "timeout": 30000,
    "xsrfCookieName": "XSRF-TOKEN",
    "xsrfHeaderName": "X-XSRF-TOKEN",
    "maxContentLength": -1,
    "maxBodyLength": -1,
    "env": {},
    "headers": {
      "Accept": "application/json, text/plain, */*",
      "Content-Type": "application/json",
      "Authorization": "Bearer cpk_4e6c011db10249f0bdc7b8f8df40cf9f.096169649b4d5c67b42bc5b83b11e149.KcltcWhOps9qvpqYOyoiSjG1JQOAkl33",
      "User-Agent": "axios/1.9.0",
      "Content-Length": "277",
      "Accept-Encoding": "gzip, compress, deflate, br"
    },
    "method": "post",
    "url": "https://llm.chutes.ai/v1/chat/completions#",
    "data": "{\"model\":\"deepseek-ai/DeepSeek-V3-0324\",\"messages\":[{\"role\":\"system\",\"content\":\"你是一个有帮助的AI助手，专注于中文对话。请提供简短的回答。\"},{\"role\":\"user\",\"content\":\"你好，请用中文回答：今天天气怎么样？请简短回复一句话\"}]}",
    "allowAbsoluteUrls": true
  },
  "code": "ERR_BAD_REQUEST",
  "status": 429
}
[2025-05-05T09:45:48.134Z] 
====== 测试结果汇总 ======
[2025-05-05T09:45:48.136Z] DeepSeek (OpenRouter): ❌ 不可用
[2025-05-05T09:45:48.137Z] DeepSeek (Chutes): ❌ 不可用
[2025-05-05T09:45:48.139Z] 
开始生成浏览器端错误处理修复代码...
[2025-05-05T09:45:48.140Z] 
// 在chat.js中找到sendStandardRequest函数和sendStreamingRequest函数的错误处理部分
// 将以下代码:
if (!response.ok) {
    let errorMessage = '请求失败';
    try {
        const errorData = await response.json();
        errorMessage = errorData.message || errorData.error || `请求失败: 状态码 ${response.status}`;
    } catch (e) {
        errorMessage = `请求失败: 状态码 ${response.status}`;
    }
    throw new Error(errorMessage);
}

// 修改为:
if (!response.ok) {
    let errorMessage = `请求失败: 状态码 ${response.status}`;
    try {
        const errorData = await response.json();
        if (typeof errorData.error === 'object') {
            errorMessage = JSON.stringify(errorData.error);
        } else {
            errorMessage = errorData.message || errorData.error || errorMessage;
        }
    } catch (e) {
        // 保持默认错误消息
    }
    throw new Error(errorMessage);
}

// 同时在catch错误处理部分，将以下代码:
errorDiv.textContent = `请求失败: ${error.message}`;

// 修改为:
let errorText = error.message;
if (errorText.includes('[object Object]')) {
    errorText = '请求失败，服务器返回了无效的错误格式';
}
errorDiv.textContent = errorText;

[2025-05-05T09:45:48.149Z] 
可以根据以上代码修复浏览器端的错误处理问题。
[2025-05-05T09:45:48.151Z] 
====== API测试结束 ======
